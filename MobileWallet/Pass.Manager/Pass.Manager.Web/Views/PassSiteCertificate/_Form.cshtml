@model PassSiteCertificateViewModel

@Html.HiddenForExt(m => m.PassSiteCertificateId)
@Html.HiddenForExt(m => m.PassSiteId)
@if (Model.IsNew)
{
    @Html.DropDownListFormForExt(x => x.PassCertificateId, Model.Certificates, "PassCertificate", "- Select Certificate -")
}

@Html.TextBlockFormForExt(m => m.PassCertificateId, "Certificate ID")

@if (Model.IsNew)
{
    @Html.HiddenForExt(m => m.Name)
}
else
{
    @Html.TextBoxFormForExt(m => m.Name, "Name")
    @Html.TextBoxFormForExt(m => m.Description, "Description")
    @Html.TextBlockFormForExt(m => m.ExpDate, "Expiration Date", "d")
}

<script type="text/javascript">
    $(document).ready(function() {
        $("#UserId").change(function() {
            OnCertificateChanged();
        });
    });

    function OnCertificateChanged() {
        $.get("@Url.Action("Get", "PassCertificate")/" + $("#PassCertificateId").val(), function(data) {
                if (data.Success != null) {
                    if (data.Success) {
                        delete data.Data.RedirectUrl;
                        $("form").autofill(data.Data);
                    } else
                        alert(data.Message);
                }
            })
            .fail(function() {
                alert("An error occurred");
            });
    }
</script>
