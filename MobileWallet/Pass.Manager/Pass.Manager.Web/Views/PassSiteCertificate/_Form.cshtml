@model PassSiteCertificateViewModel

@Html.HiddenForExt(m => m.PassSiteCertificateId)
@Html.HiddenForExt(m => m.PassSiteId)
@Html.HiddenForExt(m => m.CertificateStorageId)

@if (Model.IsNew)
{
    @Html.DropDownListFormForExt(x => x.PassCertificateId, Model.Certificates, "PassCertificate", "- Select Certificate -")
}

@Html.TextBlockFormForExt(m => m.PassCertificateId, "Certificate ID")

@if (Model.IsNew)
{
    @Html.HiddenForExt(m => m.Name)
}
else
{
    @Html.TextBoxFormForExt(m => m.Name, "Name")
}

 @Html.TextBoxFormForExt(m => m.Description, "Description")
 @Html.TextBlockFormForExt(m => m.ExpDate, "Expiration Date", "dd/MM/yyyy")
 
<script type="text/javascript">
    $(document).ready(function() {
        $("#PassCertificateId").change(function() {
            OnCertificateChanged();
        });
    });

    function OnCertificateChanged() {
        $.get("@Url.Action("Get", "PassCertificate")/" + $("#PassCertificateId").val(), function(data) {
                if (data.Success != null) {
                    if (data.Success) {
                        delete data.Data.RedirectUrl;
                        data.Data.ExpDate = kendo.toString(kendo.parseDate(data.Data.ExpDate), $("#ExpDate").data("format"));
                        $("form").autofill(data.Data);
                    } else
                        alert(data.Message);
                }
            })
            .fail(function() {
                alert("An error occurred");
            });
    }
</script>
